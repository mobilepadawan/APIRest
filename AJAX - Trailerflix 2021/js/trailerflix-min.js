let contenidoJSON=[];const GEN=["Acción","Aventura","Ciencia Ficción","Comedia","Drama","Familia","Fantasía","Hechos verídicos","Suspenso","Terror"];function cargoContenidoStreaming(){$("#contenido").html(""),$.ajax({url:"js/trailerflix.json",dataType:"json",success:function(n){guardoEnLS(n)},error:function(){$("#contenido").html(errorJSON())}})}function armoVistaFull(n){$("#contenido").html("");for(const e of n)$("#contenido").append(buildCard(e))}function guardoEnLS(n){localStorage.contenidoJSON=JSON.stringify(n)}function buildCard(n){let e="",o="";return o=`<p class="yellow-text">DURACIÓN: <span class="white-text">${n.duracion}</span></p>`,"Serie"==n.categoria&&(o=`<p class="yellow-text">TEMPORADAS: <span class="white-text">${n.temporadas}</span></p>`),e+=`<div class="col s12 m6 l3">\n                      <div class="card z-depth-2 max-wide">\n                         <div class="card-image">\n                            <img loading="lazy" src="${n.poster}" alt="${n.titulo}" title="${n.titulo}" id="trailerflix-"${n.id}" width="440">\n                            <a class="btn-floating halfway-fab waves-effect waves-light red darken-2"><i class="material-icons"  onclick="verDetalle(${n.id})">search</i></a>\n                         </div>\n                         <div class="card-content black">\n                            <p class="yellow-text">GÉNERO: <span class="white-text">${n.gen}</span></p>\n                            ${o}\n                         </div>\n                      </div>\n                   </div>`,e}function errorJSON(){let n="";return n='<div class="center white-text"> \n                      <br><br> \n                      <h2>El contenido no está disponible. Intente nuevamente en unos minutos.</h2> \n                      <br><br> \n                      <i class="large material-icons">sentiment_very_dissatisfied</i> \n                      <br><br> \n                   </div>','<div class="center white-text"> \n                      <br><br> \n                      <h2>El contenido no está disponible. Intente nuevamente en unos minutos.</h2> \n                      <br><br> \n                      <i class="large material-icons">sentiment_very_dissatisfied</i> \n                      <br><br> \n                   </div>'}function verDetalle(n){0==contenidoJSON.length&&(contenidoJSON=JSON.parse(localStorage.contenidoJSON));let e=contenidoJSON.find((e=>e.id==n));null!=e?(localStorage.setItem("contenido",JSON.stringify(e)),location.href="detail.html"):M.toast({html:"Contenido temporalmente no disponible.",classes:"red darken-3 white-text"})}function buscarToggle(){$("#txtBuscar").val(""),$("#divBuscar").slideToggle(),$("#txtBuscar").focus()}function tituloCateroria(n){return`<div class="col s12 m12 l12">\n               <div class="center" width="100%">\n                   <h2 class="white-text vertical-spaces">${n}</h2>\n               </div>\n           </div>`}function buscarContenido(n){if(null!=localStorage.contenidoJSON){contenidoJSON=JSON.parse(localStorage.contenidoJSON);const e=contenidoJSON.filter((e=>e.busqueda.includes(n)));if(0==e.length)M.toast({html:"<p>No se encontró contenido asociado :(</p>",classes:"red darken3 white-text"});else{$("#contenido").html(""),leyendaResultados=`<p class="red-text darken3">Se encontraron ${e.length} coincidencias.</p>`,$("#contenido").append(leyendaResultados);for(const n of e)$("#contenido").append(buildCard(n));buscarToggle()}}}function agrupoPorGenero(n,e){$("#contenido").html("");for(const n of GEN){const o=e.filter((e=>e.gen.includes(n)));$("#contenido").append(tituloCateroria(n));for(const n of o)$("#contenido").append(buildCard(n))}}function muestroTodo(n){armoVistaFull(n)}async function recuperoContenido(){contenidoJSON=JSON.parse(localStorage.contenidoJSON)}function recargoContenido(){cargoContenidoStreaming()}function muestroGeneros(){null!=localStorage.contenidoJSON&&""!=localStorage.contenidoJSON||cargoContenidoStreaming(),recuperoContenido(),agrupoPorGenero(GEN,contenidoJSON)}setTimeout((()=>{muestroGeneros(),$("#contenido").fadeIn("slow",(()=>$("#visualizacion").fadeIn(1e3,(()=>$("#cargando").fadeOut(200)))))}),1e3),$("#txtBuscar").on("keypress",(function(n){13===n.keyCode&&buscarContenido($("#txtBuscar").val())})),$("#btnTodos").click((()=>{recuperoContenido(),muestroTodo(contenidoJSON)})),$("#btnCategorias").click((()=>muestroGeneros())),$("#btnRecargar").click((()=>{recargoContenido(),location.reload()}));